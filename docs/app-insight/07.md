# 第 7 章消费和导出数据

如果回看[图 1](02.html#Figure1) ，可以看到无论定价选项是什么，数据赎回政策都不超过 90 天。因此，如果您想要保留 web 应用程序的使用历史，您需要从 Application Insights 资源中导出数据，并将其存储在另一个地方。各种功能有助于实现这一目标，因此我们应该考虑所有可用的选项，从 Application Insights 获取遥测数据。

如果您是高级商务智能用户，您可以使用它直接连接到您的应用洞察资源。

| ![](../Images/note.png) | 注意:Power BI 是微软提供的一套业务分析工具，用于分析数据。使用该套件，公司可以使用每台设备上提供的丰富仪表板来监控其业务。更多信息，请访问[powerbi.microsoft.com](https://powerbi.microsoft.com)或查看 Syncfusion 的电子书，Pierstefano Tucci 的 [Power BI 简洁地](https://www.syncfusion.com/ebooks/power_bi_succinctly)。 |

要将 Power BI 连接到应用洞察，您需要在 [Power BI](https://powerbi.microsoft.com) 上有一个帐户。

![](../Images/image029.jpg)

图 21:商务智能主页

在主页上，您必须使用**服务**，并筛选出可用的内容包以找到合适的内容包，以便连接到**应用洞察**。

![](../Images/image030.jpg)

图 22:强大的商业智能内容包

选择正确的内容包后，您需要输入所需的信息(**资源名称**、**资源组**和 **Azure 订阅 ID** )以连接到应用洞察资源。

![](../Images/image031.jpg)

图 23:连接到应用洞察资源

最后，完成登录后，您将可以访问 Power BI 中的应用洞察数据，就像访问任何其他来源类型一样。

![](../Images/image032.png)

图 24:连接到应用洞察资源的智能商务智能

应用洞察 REST API 是一种使用 REST API 服务从应用洞察获取数据的编程方式。这里有。

| ![](../Images/tip.png) | 提示:在写这本书的时候，这个功能是可以在公共预览中使用的。这意味着开发仍在进行中，因此在最终发布的道路上，事情可能会发生变化(或多或少的显著变化)。有关变更的信息，请参考本[变更日志](https://dev.applicationinsights.io/changelog/)。 |

这个 REST 应用编程接口允许您查询关于应用洞察资源的数据。

在使用该应用编程接口之前，您必须配置对它的访问*。*为此，打开**配置**部分的**应用编程接口访问**刀片，创建一个应用编程接口密钥。

![](../Images/image034.jpg)

图 25:应用编程接口访问刀片

创建对数据的访问时，可以为 API 键指定一个名称，以及以下一项或两项权限:

*   **读取遥测数据**:允许您从应用洞察资源中读取数据。
*   **编写注释**:允许您在应用洞察资源中编写注释(而不是数据)。注释是关于重要事件的附加信息。

点击**生成密钥**按钮，您将能够完成操作，并收到一个带有您提供给它的名称和权限的应用编程接口密钥。

| ![](../Images/tip.png) | 提示:您可能需要多个应用编程接口键。例如，您可以使用该数据为每个业务应用程序创建一个密钥，即使它们具有相同的权限。这样，您可以随时更改或撤销权限，而不会影响其他相关的业务应用程序。 |

在使用此应用编程接口密钥之前(例如，从消费者应用程序中)，您可以从**应用编程接口浏览器**页面尝试它。

![Immagine che contiene screenshot  Descrizione generata con affidabilità molto elevata](../Images/image036.jpg)

图 26:应用编程接口浏览器页面

要使用该测试工具，您需要一个**应用编程接口密钥**和**应用程序标识**。应用程序标识可在 Azure 门户中的**应用编程接口密钥**刀片中获得。

使用**度量标识**字段，您可以从度量列表中选择合适的一个来从应用编程接口获取数据。在这个表单上，大多数字段都很简单易懂，因为您只需要从列表中选择一个建议的项目。

该特性背后的目标是让您在业务应用程序中使用 API 之前，查看从 API 返回的数据是否正是您想要的。在这里，您可以设置不同的参数来过滤结果，例如聚合类型或时间跨度。

如图 26 所示，您可以预览 API 请求和响应。

一旦您测试了适当的应用编程接口，您就可以像其他 REST 应用编程接口服务一样在您的业务应用程序中使用它。

## 持续出口

由于数据保留不是无限的，如果我们想要保留信息，我们应该在预定的时间从我们的应用洞察资源中导出数据。

此功能在基本和企业定价计划中都可用，但第一个选项(免费)使用每千兆字节收费，第二个选项可以不受任何限制地使用。

要使用此功能，请从应用洞察功能刀片的**配置**部分选择**连续导出**。为了创建一个连续的导出项，我们必须配置一些参数，如图 27 所示。

![](../Images/image037.jpg)

图 27:连续导出特性

这些参数中的第一个代表要导出的数据，因此我们可以定义我们想要收集的确切信息类型:

*   **可用性**:我们应用的所有 web 测试的数据结果。
*   **定制事件**:所有用`TrackEvent()`方法注册的信息(见[第九章](09.html#_Chapter_9_))。
*   **依赖关系**:所有与外部资源(DBs、服务等)相关的时间使用数据。).
*   **异常**:所有服务器异常的数据结果和用`TrackException()`方法注册的异常数据(见[第 9 章](09.html#_Chapter_9_))。
*   **公制**:用`TrackMetric()`法记录的所有信息(见[第九章](09.html#_Chapter_9_))。
*   **页面加载**:在浏览器中加载一个页面所花费的时间。
*   **页面浏览量**:我们的 web 应用的页面浏览量。
*   **性能计数器**:应用洞察状态监视器收集的性能计数器。
*   **请求**:服务器收到的 HTTP 请求的信息。
*   **追踪**:记录遥测数据和所有用`TrackTrace()`方法登记的数据(见[第 9 章](09.html#_Chapter_9_))。

由于我们需要使用 Azure Storage 资源(这是唯一受支持的容器类型)，所有其他参数都与我们要导出所收集数据的存储相关。

| ![](../Images/note.png) | 注意:我们将不涉及 Azure 上存储的创建，这超出了本书的范围。如果您想了解更多信息，请参考本[文档](https://docs.microsoft.com/en-us/azure/storage/)。 |

*   **存储位置**参数:建议值与 Application Insights 资源区相同，如果更改，可能会产生额外费用。

一旦我们选择了目标存储，我们必须为它选择(或创建)一个容器。此功能将在您创建后立即工作，同时您可以使用刀片上的**禁用**按钮来停止它。

| ![](../Images/tip.png) | 提示:请记住，使用连续导出可能会导致您产生额外费用；有关更多详细信息，请参考应用洞察的[定价选项](02.html#_Pricing_options_for)部分。请注意，Visual Studio MSDN 订阅服务器不能使用此功能。 |

导出的数据将采用 JSON 格式，并将代表应用洞察从网络应用程序接收的原始遥测数据。

导出的数据在记录后一个小时内可能会出现在存储器中，因此**不要将此功能视为实时导出**。

导出的数据可以在存储中保留任意长的时间，尽管您需要为此付费。当然，您可以将数据导出到本地存储，以避免高额存储费用。

下一步是在代码中与应用洞察资源进行交互。在下一章中，您将看到 Visual Studio 正在运行。